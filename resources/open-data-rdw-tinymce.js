var rdw_table = '<table class="open-data-settings-table"><tbody><tr class="open-rdw-header"><th colspan="2"><a href="#">Voertuig</a></th></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Kenteken" id="id_kenteken"></td><td><label for="id_kenteken">Kenteken</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Merk" id="id_merk"></td><td><label for="id_merk">Merk</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Handelsbenaming" id="id_handelsbenaming"></td><td><label for="id_handelsbenaming">Handelsbenaming</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Voertuigsoort" id="id_voertuigsoort"></td><td><label for="id_voertuigsoort">Voertuigsoort</label></td></tr><tr class="open-rdw-header"><th colspan="2"><a href="#">Uitvoering</a></th></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Eerstekleur" id="id_kleur1"></td><td><label for="id_kleur1">Kleur (1)</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Tweedekleur" id="id_kleur2"></td><td><label for="id_kleur2">Kleur (2)</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Aantalzitplaatsen" id="id_aantalZitplaatsen"></td><td><label for="id_aantalZitplaatsen">Aantal zitplaatsen</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Aantalstaanplaatsen" id="id_aantalStaanplaatsen"></td><td><label for="id_aantalStaanplaatsen">Aantal staanplaatsen</label></td></tr><tr class="open-rdw-header"><th colspan="2"><a href="#">Motor</a></th></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Hoofdbrandstof" id="id_brandstof1"></td><td><label for="id_brandstof1">Brandstof (1)</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Nevenbrandstof" id="id_brandstof2"></td><td><label for="id_brandstof2">Brandstof (2)</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Aantalcilinders" id="id_aantalCilinders"></td><td><label for="id_aantalCilinders">Aantal cilinders</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Cilinderinhoud" id="id_cilinderinhoud"></td><td><label for="id_cilinderinhoud">Cilinderinhoud</label></td></tr><tr class="open-rdw-header"><th colspan="2"><a href="#">Gewicht en laadvermogen</a></th></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Massaleegvoertuig" id="id_massaLeegVoertuig"></td><td><label for="id_massaLeegVoertuig">Massa leeg voertuig</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Laadvermogen" id="id_laadvermogen"></td><td><label for="id_laadvermogen">Laadvermogen</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Toegestanemaximummassavoertuig" id="id_maximumMassa"></td><td><label for="id_maximumMassa">Toegestane maximum massa voertuig</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Massarijklaar" id="id_massaRijklaar"></td><td><label for="id_massaRijklaar">Massa rijklaar</label></td></tr><tr class="open-rdw-header"><th colspan="2"><a href="#">Maximum te trekken massa</a></th></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Maximumtetrekkenmassaongeremd" id="id_maximumMassaOngeremd"></td><td><label for="id_maximumMassaOngeremd">Ongeremd</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Maximumtetrekkenmassageremd" id="id_maximumMassaGeremd"></td><td><label for="id_maximumMassaGeremd">Geremd</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Maximumtetrekkenmassaopleggergeremd" id="id_maximumMassaOpleggerGeremd"></td><td><label for="id_maximumMassaOpleggerGeremd">Oplegger geremd</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Maximumtetrekkenmassaautonoomgeremd" id="id_maximumMassaAutonoomGeremd"></td><td><label for="id_maximumMassaAutonoomGeremd">Autonoom geremd</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Maximumtetrekkenmassamiddenasgeremd" id="id_maximumMassaMiddenasGeremd"></td><td><label for="id_maximumMassaMiddenasGeremd">Middenas geremd</label></td></tr><tr class="open-rdw-header"><th colspan="2"><a href="#">Historie</a></th></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Datumeerstetoelating" id="id_datumEersteToelatingInternationaal"></td><td><label for="id_datumEersteToelatingInternationaal">Datum eerste toelating</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="DatumeersteafgifteNederland" id="id_datumEersteToelatingNationaal"></td><td><label for="id_datumEersteToelatingNationaal">Datum eerste afgifte Nederland</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="Datumaanvangtenaamstelling" id="id_datumAansprakelijkheid"></td><td><label for="id_datumAansprakelijkheid">Datum laatste tenaamstelling</label></td></tr><tr style="display:none"><td style="width: 16px;"><input type="checkbox" class="checkbox" name="VervaldatumAPK" id="id_datumVervalApk"></td><td><label for="id_datumVervalApk">Vervaldatum APK</label></td></tr></tbody></table>';
var rdw_modal = [
    '<div class="open-rdw-modal-background">',
    '<div class="open-rdw-modal">',
    '<h3>Selecteer welke velden weergegeven moeten worden:</h3>',
    rdw_table,
    '<p>',
    '<input type="submit" class="button action" value="Annuleren" id="open-rdw-modal-cancel">',
    '<input type="submit" class="button-primary" value="Shortcode toevoegen" id="open-rdw-modal-confirm">',
    '</p>',
    '</div>',
    '</div>'
].join('\n');

jQuery(document).ready(function($) {
    if (typeof tinymce !== 'undefined') {
        tinymce.create('tinymce.plugins.open_data_rdw_plugin', {
            init: function(ed, url) {
                // Register command for when button is clicked
                ed.addCommand('open_data_rdw_insert_shortcode', function() {

                    var rdw_fields = [];
                    $('body').append(rdw_modal);
                    var $modal = $('.open-rdw-modal-background');
                    $modal.fadeIn(250);

                    $('#open-rdw-modal-cancel').on('click', function(e) {
                        e.preventDefault();
                        $modal.fadeOut(250, function() {
                            $modal.remove();
                        });
                    });

                    $('#open-rdw-modal-confirm').on('click', function(e) {
                        e.preventDefault();
                        $('.open-data-settings-table input:checked').map(function() {
                            var value = $(this).attr('name');
                            rdw_fields.push(value);
                        });
                        if (rdw_fields.length > 0) {
                            content = '[open_data_rdw_check "' + rdw_fields.join('" "') + '"]';
                        } else {
                            content = '[open_data_rdw_check]';
                        }

                        tinymce.execCommand('mceInsertContent', false, content);
                        $modal.fadeOut(250, function() {
                            $modal.remove();
                        });
                    });

                });

                // Register buttons - trigger above command when clicked
                ed.addButton('open_data_rdw_button', {
                    title: 'Insert shortcode',
                    cmd: 'open_data_rdw_insert_shortcode',
                    image: url + '/open-rdw_grey.png'
                });
            },
        });

        // Register our TinyMCE plugin
        // first parameter is the button ID1
        // second parameter must match the first parameter of the tinymce.create() function above
        tinymce.PluginManager.add('open_data_rdw_button', tinymce.plugins.open_data_rdw_plugin);
    }

});